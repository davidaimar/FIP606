---
title: "aula8"
format: html
editor_options: 
  chunk_output_type: console
---

# 15/05/2024

## Pacotes

```{r}
library(tidyverse)
library(gsheet)
library(ggthemes)
library(lme4)
library(car)
library(performance)
library(DHARMa)
library(emmeans)
library(multcomp)
library(r4pde)
library(broom)
library(patchwork)

```

## Anova fatorial

```{r}
library(gsheet)
fungicida <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=2023059672")


fungicida$dose <- as.factor(fungicida$dose)

fungicida |> 
  ggplot(aes(treat,severity, color = dose))+
  #geom_boxplot()+
  geom_jitter(width = 0.2, size = 2.5)+
  #facet_wrap(~dose)+
  theme_few()+
  scale_fill_few()+
  theme(legend.title = element_blank(), legend.position = "none")
  
mf <- lm(severity ~ treat*dose, data = fungicida)

mf
anova(mf)

plot(simulateResiduals(mf))

mf_medias <- emmeans(mf, ~ treat | dose)
mf_medias
cld(mf_medias)

mf_medias_linha <- emmeans(mf, ~ dose | treat)
mf_medias_linha
cld(mf_medias_linha,Letters = letters)

```

## importa dados

```{r}
milho <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1345524759")

```

## Vizualizar

```{r}
milho |> 
  ggplot(aes(method, index))+
  geom_jitter(width = 0.01, color = "black")+
  facet_wrap(~hybrid)+
  stat_summary(fun.data = "mean_cl_boot", color = 'black', size = 0.5, alpha = 0.5)+
  theme_few()+
    labs(x = 'Method',
       y = 'Index')

```

## Modelo para análise estatística em parcelas subdivididas

### Variável 1

```{r}
milho <- milho |> 
  mutate(block = as.factor(block))

mix2 <- lmer(sqrt(index) ~ hybrid*method + block + (1|block/hybrid), data = milho) # Modelos Lineares de Efeitos Mistos
 
Anova(mix2)

```

### Testando a premissas

```{r}
check_normality(mix2)
check_heteroscedasticity(mix2)


qqnorm(residuals(mix2))
qqline(residuals(mix2))
hist(residuals(mix2))

shapiro.test(residuals(mix2))

```

### Teste de médias

```{r}
medias_milho <- emmeans(mix2,
                        ~ hybrid | method,
                        type = "response")

medias_milho2 <- emmeans(mix2,
                        ~ method | hybrid,
                        type = "response")

```

### Vizualizando

```{r}
cld(medias_milho, Letters = letters)

```

```{r}
cld(medias_milho2, Letters = letters)

```

## Variável 2

```{r}
mix3<- lmer(sqrt(yield) ~ hybrid*method + block + (1|block/hybrid), data = milho)

Anova(mix3)

```

## Testando a premissas

```{r}
check_normality(mix3)
check_heteroscedasticity(mix3)

qqnorm(residuals(mix3))
qqline(residuals(mix3))

hist(residuals(mix3))

```

## Teste de médias

```{r}
medias_milho_prod <- emmeans(mix3,
                        ~ hybrid | method,
                        type = "response")

medias_milho_prod2 <- emmeans(mix3,
                        ~ method | hybrid,
                        type = "response")

```

### Vizualizando

```{r}
cld(medias_milho_prod, Letters = letters)

```

```{r}
cld(medias_milho_prod2, Letters = letters)

```
